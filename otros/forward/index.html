<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Port Forwarding</title>
<link rel="shortcut icon" type="image/png" sizes="64x64" href="">
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Port Forwarding" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Explicación y uso del Port Forwarding" />
<meta property="og:description" content="Explicación y uso del Port Forwarding" />
<link rel="canonical" href="http://localhost:4000/another-page.html" />
<meta property="og:url" content="http://localhost:4000/another-page.html" />
<meta property="og:site_name" content="Port Forwarding" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Port Forwarding" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Explicación y uso del Remote Port Forwarding","headline":"GatoGamer1155","url":"http://localhost:4000/another-page.html"}</script>

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/assets/js/respond.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  </head>
  <body>

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Port Forwarding</h1>
          <p>Explicación y uso del Port Forwarding</p>
        </div>

<div><strong><h3>Port Forwarding local con ssh</h3></strong></div><br>

<div><p>Pongamos un ejemplo, hay un servicio interno corriendo en el puerto 3000 de una maquina y queremos conectarnos desde nuestra máquina local pero no lo vemos externamente</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ nc 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap </span><span class="p">-p 3000 10.10.10.10
Nmap scan report for parrot (10.10.10.10)
PORT     STATE  SERVICE
3000/tcp closed ppp</span>
</code></pre></div></div><br>

<div><p>Si tenemos acceso por ssh podemos hacer simple de un port forwarding por ssh</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ ssh</span><span class="p"> user@10.10.10.10 -L 3000:127.0.0.1:3000
</span><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>En este caso este port forwarding se representaría de la siguiente manera</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="p"></span><span class="na">3000</span><span class="p">:</span><span class="no">127.0.0.1</span><span class="p">:</span><span class="s2">3000</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">3000</span><span class="p"> -> Puerto de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="no">127.0.0.1</span><span class="p"> -> Host de donde tomaremos el puerto</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">3000</span><span class="p"> -> Puerto que tomaremos de la máquina victima</span>
</code></pre></div></div><br>

<div><p>En este caso en local el puerto 3000 estará abierto, pero conectado a la máquina</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap </span><span class="p">-p 3000 localhost
Nmap scan report for localhost (127.0.0.1)
PORT     STATE  SERVICE
3000/tcp open   ppp</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nc</span><span class="p"> 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">127.0.0.1</span><span class="p">:</span><span class="no">3000</span><span class="p">   --->   </span><span class="s2">10.10.10.10</span><span class="p">:</span><span class="no">3000</span>
</code></pre></div></div><br>

<div><strong><h3>Port Forwarding de un contenedor con ssh</h3></strong></div><br>

<div><p>Usemos el mismo ejemplo anterior pero en este caso el puerto no está en la máquina victima sino que desde la máquina victima accedemos al puerto de un contenedor -> 172.17.0.2</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ nc 172.17.0.2 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>

<div><p>En este caso solo hay que cambiar el host con lo que hemos visto antes</p></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ ssh</span><span class="p"> user@10.10.10.10 -L 3000:172.17.0.2:3000
</span><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>En este caso este port forwarding se representaría de la siguiente manera</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="p"></span><span class="na">3000</span><span class="p">:</span><span class="no">172.17.0.2</span><span class="p">:</span><span class="s2">3000</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">3000</span><span class="p"> -> Puerto de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="no">172.17.0.2</span><span class="p"> -> Host de donde tomaremos el puerto</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">3000</span><span class="p"> -> Puerto que tomaremos de la máquina victima</span>
</code></pre></div></div><br>

<div><p>En este caso en local el puerto 3000 estará abierto, pero conectado a el contenedor</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap </span><span class="p">-p 3000 localhost
Nmap scan report for localhost (127.0.0.1)
PORT     STATE  SERVICE
3000/tcp open   ppp</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nc</span><span class="p"> 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">127.0.0.1</span><span class="p">:</span><span class="no">3000</span><span class="p">   --->   </span><span class="k">10.10.10.10</span><span class="p">   --->   </span><span class="s2">172.17.0.2</span><span class="p">:</span><span class="no">3000</span>
</code></pre></div></div><br>

<div><strong><h3>Port Forwarding local con chisel</h3></strong></div><br>

<div><p>Usemos el ejemplo inicial donde nos conectamos en la misma máquina</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ nc 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>

<div><p>En nuestra máquina dejaremos a chisel como server en escucha por el puerto 8000</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ chisel </span><span class="p">server --reverse --port 8000
00:00:00 server: Reverse tunnelling enabled
00:00:00 server: Listening on http://0.0.0.0:8000</span>
</code></pre></div></div>

<div><p>En la máquina victima como cliente podemos enviar el puerto de la siguiente manera</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ ./chisel client 10.10.14.10:8000 R:3000:127.0.0.1:3000</span>
</code></pre></div></div>

<div><p>Analizemos esta linea parte a parte</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p">:</span><span class="k">8000 </span><span class="p">R:</span><span class="na">3000</span><span class="p">:</span><span class="no">127.0.0.1</span><span class="p">:</span><span class="s2">3000</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p"> -> Host de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="k">8000</span><span class="p"> -> Puerto donde estamos en escucha</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">3000</span><span class="p"> -> Puerto de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="no">127.0.0.1</span><span class="p"> -> Host de donde tomaremos el puerto</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">3000</span><span class="p"> -> Puerto que tomaremos de la máquina victima</span>
</code></pre></div></div><br>

<div><p>En este caso en local el puerto 3000 estará abierto, pero conectado a la máquina</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap </span><span class="p">-p 3000 localhost
Nmap scan report for localhost (127.0.0.1)
PORT     STATE  SERVICE
3000/tcp open   ppp</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nc</span><span class="p"> 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">127.0.0.1</span><span class="p">:</span><span class="no">3000</span><span class="p">   --->   </span><span class="s2">10.10.10.10</span><span class="p">:</span><span class="no">3000</span>
</code></pre></div></div><br>

<div><strong><h3>Port Forwarding de un contenedor con chisel</h3></strong></div><br>
<div><p>Usando el ejemplo del puerto en el contenedor esta vez lo pasaremos con chisel</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ nc 172.17.0.2 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>

<div><p>Simplemente hay que cambiar la dirección del host igual que antes</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ ./chisel client 10.10.14.10:8000 R:3000:172.17.0.2:3000</span>
</code></pre></div></div>

<div><p>En este caso se representaría de la siguiente manera</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p">:</span><span class="k">8000 </span><span class="p">R:</span><span class="na">3000</span><span class="p">:</span><span class="no">172.17.0.2</span><span class="p">:</span><span class="s2">3000</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p"> -> Host de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="k">8000</span><span class="p"> -> Puerto donde estamos en escucha</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">3000</span><span class="p"> -> Puerto de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="no">172.17.0.2</span><span class="p"> -> Host de donde tomaremos el puerto</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">3000</span><span class="p"> -> Puerto que tomaremos de la máquina victima</span>
</code></pre></div></div><br>

<div><p>En este caso en local el puerto 3000 estará abierto, pero conectado a el contenedor</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap </span><span class="p">-p 3000 localhost
Nmap scan report for localhost (127.0.0.1)
PORT     STATE  SERVICE
3000/tcp open   ppp</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nc</span><span class="p"> 127.0.0.1 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">127.0.0.1</span><span class="p">:</span><span class="no">3000</span><span class="p">   --->   </span><span class="k">10.10.10.10</span><span class="p">   --->   </span><span class="s2">172.17.0.2</span><span class="p">:</span><span class="no">3000</span>
</code></pre></div></div><br>

<div><strong><h3>Port Forwarding con chisel usando proxychains</h3></strong></div><br>
<div><p>Haremos lo mismo que antes pero con proxychains para tener mas alcance</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ nc 172.17.0.2 3000
Esto es un servicio de prueba
</span>
</code></pre></div></div>

<div><p>En este caso en lugar de indicar puerto y host enviaremos directamente socks</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">user@parrot</span><span class="p">:</span><span class="na">~</span><span class="p">$ ./chisel client 10.10.14.10:8000 R:socks</span>
</code></pre></div></div>

<div><p>Ahora nuestra configuración seria la siguiente</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p">:</span><span class="s2">8000 </span><span class="p">R:</span><span class="no">socks</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">10.10.14.10</span><span class="p"> -> Host de nuestra máquina local</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">8000</span><span class="p"> -> Puerto donde estamos en escucha</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="no">socks</span><span class="p"> -> Conexión socks5 que abre el puerto 1080</span>
</code></pre></div></div><br>

<div><p>Hay que agregar al final de la config de proxychains la conexion y puerto</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ echo </span><span class="no">"socks5 127.0.0.1 1080"</span><span class="p"> >> /etc/proxychains.conf
</span><span class="s2">❯ cat </span><span class="p">/etc/proxychains.conf | </span><span class="s2">tail</span><span class="p"> -n1
socks5 127.0.0.1 1080</span>
</code></pre></div></div><br>

<div><p>Ahora con proxychains podemos apuntar a donde sea como si fuera la máquina victima</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ proxychains </span><span class="p">nmap -p 3000 172.17.0.2
Nmap scan report for 172.17.0.2
PORT     STATE  SERVICE
3000/tcp open   ppp</span>
</code></pre></div></div><br>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ proxychains </span><span class="p">nc 172.17.0.2 3000
Esto es un servicio de prueba</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">proxychains</span><span class="p">:</span><span class="no">1080</span><span class="p">   --->   </span><span class="k">10.10.10.10</span><span class="p">   --->   </span><span class="s2">172.17.0.2</span><span class="p">:</span><span class="no">3000</span>
</code></pre></div></div><br>

<p><a href="./../../">Página Principal</a></p>

      </section>

    </div>
  </body>
</html>
